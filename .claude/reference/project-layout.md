# Project Layout Reference

Read this to understand what every file and folder does and how they connect.

## Root Directory

```
oparax-chirp/
├── frontend/              # The entire web application (see below)
├── backend/               # Python API server (planned, empty — just .gitkeep)
├── scripts/               # Standalone Python scripts for API experiments
│   └── search_test.py     # Tests X API v2 tweet search endpoint
├── .claude/               # Claude Code configuration (reference docs, skills, agents)
├── CLAUDE.md              # Main instructions for Claude Code (max 150 lines)
├── README.md              # Public-facing project documentation
├── pyproject.toml         # Python project config — lists Python dependencies
├── uv.lock                # Python dependency lock file (auto-generated, don't edit)
├── package.json            # Root Node.js config (only has Supabase deps for workspace)
├── package-lock.json      # Legacy npm lock file (ignore — we use pnpm)
├── .env                   # Python API credentials (git-ignored, never committed)
├── .gitignore             # Lists files Git should not track
└── LICENSE                # GNU AGPL v3.0 license
```

### Files you DON'T touch (auto-generated)

- **`uv.lock`** — Auto-generated by `uv sync`. Records exact Python package versions.
- **`package-lock.json`** — Legacy file from npm. We use pnpm, so this is ignored. Exists only because it was created before pnpm was adopted. Causes a Turbopack warning if not handled (see `next.config.ts`).

## Frontend Directory

```
frontend/
├── app/                   # YOUR PAGES — Next.js App Router
├── components/            # UI COMPONENTS — shadcn/ui components go here
├── lib/                   # SHARED UTILITIES — reusable functions + cn() helper
├── public/                # STATIC FILES — images, icons (served as-is)
├── __tests__/             # TESTS — Vitest unit tests
├── node_modules/          # Downloaded packages (auto-generated, don't edit)
├── .next/                 # Build output (auto-generated, don't edit)
├── .env.local             # Supabase credentials (git-ignored)
├── package.json           # Dependencies and scripts (pnpm install/dev/build/test)
├── pnpm-lock.yaml         # Locked dependency versions (auto-generated by pnpm)
├── pnpm-workspace.yaml    # Workspace config for pnpm monorepo support
├── components.json        # shadcn/ui configuration
├── tsconfig.json          # TypeScript compiler settings
├── next.config.ts         # Next.js build configuration
├── vitest.config.ts       # Test runner configuration
├── vitest.setup.ts        # Test setup (loads test matchers)
├── eslint.config.mjs      # Linting rules
├── postcss.config.mjs     # PostCSS config (Tailwind CSS plugin)
├── proxy.ts               # Runs on EVERY request — refreshes auth session
└── README.md              # Frontend-specific docs
```

### Files you DON'T touch (auto-generated)

- **`node_modules/`** — All downloaded JavaScript packages. Created by `pnpm install`. Like Python's `site-packages/`. Never edit or commit this.
- **`.next/`** — Next.js build output. Created by `pnpm build` or `pnpm dev`. Never edit.
- **`pnpm-lock.yaml`** — Exact versions of every package. Auto-updated when you add/remove packages.

## App Router — How Pages Work

Next.js uses the filesystem to define routes. Each folder in `app/` becomes a URL path:

```
frontend/app/
├── layout.tsx                  # Root layout — wraps EVERY page (loads fonts, sets <html>)
├── globals.css                 # All colors, theme, Tailwind setup
├── favicon.ico                 # Browser tab icon
│
├── (auth)/                     # Route group — parentheses mean NO URL impact
│   ├── layout.tsx              # Auth layout — centers the card on screen
│   ├── page.tsx                # The auth page at "/" — tabbed signup/signin form
│   ├── login/
│   │   └── actions.ts          # Server action — handles login form submission
│   └── signup/
│       ├── actions.ts          # Server action — handles signup form submission
│       ├── page.tsx            # Redirects old /signup URL to /?tab=signup
│       └── check-email/
│           └── page.tsx        # "Check your email" confirmation page
│
├── auth/
│   └── confirm/
│       └── route.ts            # API route — handles email verification link clicks
│
└── dashboard/
    └── page.tsx                # Protected page — shows user info, redirects if not logged in
```

### Key file conventions

| File name | What it does |
| --------- | ------------ |
| `page.tsx` | A visible page at that URL path |
| `layout.tsx` | Wraps child pages (shared UI like headers, footers) |
| `route.ts` | An API endpoint (not a visual page) |
| `actions.ts` | Server-side functions that forms submit to |
| `globals.css` | Global styles loaded once for the entire app |

### Route group: `(auth)/`

The parentheses `()` create a "route group." Files inside `(auth)/` share a layout (`layout.tsx` — the centered card) but the `(auth)` part doesn't appear in the URL. So `app/(auth)/page.tsx` serves the route `/`, not `/auth`.

## Lib Directory — Shared Utilities

```
frontend/lib/
├── supabase/
│   ├── client.ts           # Supabase client for BROWSER code
│   ├── server.ts           # Supabase client for SERVER code (actions, route handlers)
│   └── middleware.ts        # Session refresh utility (called by proxy.ts)
├── validation.ts           # validateAuthForm() — checks email/password before sending to Supabase
└── auth-errors.ts          # mapAuthError() — converts Supabase errors to user-friendly messages
```

### The proxy.ts vs middleware.ts confusion

These two files have confusingly similar names but do different things:

| File | What it is | What it does |
| ---- | ---------- | ------------ |
| `frontend/proxy.ts` | Next.js per-request hook (the framework feature) | Runs on every HTTP request. Calls `updateSession()`. |
| `frontend/lib/supabase/middleware.ts` | A regular utility file (just a helper function) | Contains `updateSession()` which refreshes auth cookies. |

`proxy.ts` is the entry point that Next.js calls automatically. It delegates to `lib/supabase/middleware.ts` which does the actual work. The name `middleware.ts` in the lib folder comes from Supabase's documentation — it could just as easily be called `session.ts`.

## Data Flow

```
User visits a page
      │
      ▼
  proxy.ts (runs first on every request)
      │ calls updateSession()
      ▼
  lib/supabase/middleware.ts
      │ refreshes auth cookies via getUser()
      ▼
  App Router picks the page
      │
      ├─ page.tsx renders (may check auth via lib/supabase/server.ts)
      │
      └─ If user submits a form:
           │
           ▼
         actions.ts (runs on server)
           │ validates via lib/validation.ts
           │ calls Supabase via lib/supabase/server.ts
           │ maps errors via lib/auth-errors.ts
           │ redirects user
           ▼
         Next page loads
```
